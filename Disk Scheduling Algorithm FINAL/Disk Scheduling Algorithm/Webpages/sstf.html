<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../Css/navigation-bar.css">
    <link rel="stylesheet" href="../Css/body.css">
    <link rel="stylesheet" href="../Css/text-area.css">
        <link rel="stylesheet" href="../Css/graph.css">
    <title>Disk Scheduling Algorithm</title>
</head>
<body>
    <header> 
                <div class="header-content">
                    
                    <img src="C:\Users\User\Downloads\Drive-1-removebg-preview.png" alt="Project Logo" class="logo">
                    
                    <h4>Disk Scheduling Algorigthm</h4>
                </div>
            </header>

    <div class="disk">
        <h2>SSTF - Shortest Seek Time First</h2>
        <div class="input-field">
            <div class="text-area">
                <h5>Enter the request sequence:</h5>
                <input type="text" placeholder="Eg: 10, 25, 40 (Maximum input value = 199)">
            </div>
            <div class="text-area">
                <h5>Enter the initial head posistion:</h5>
                <input type="text" placeholder="Eg: 20 (Maximum input value = 199)">
            </div>
            <button class="run">RUN</button>
        </div>
    </div>
    <div class="expected-output">
        <h2>Expected output of the algorithm: </h2>
        <p>Total seek time is: </p>
        <p>Sequence of execution: </p>
        <p>Average seek time: </p>
    </div>

    <nav>
    <div class="home">
        <a href="../Webpages/Homepage.html"><button class="home-btn"> Home </button> </a>
    </div>

    <div class="dropdown">
        <button class="sim-btn"> Simulation </button>
        <div class="sim-cnt">
            <a href="../Webpages/fcfs.html"> FCFS</a>
            <a href="../Webpages/sstf.html"> SSTF</a>
            <a href="../Webpages/scan.html"> SCAN</a>
            <a href="../Webpages/c-scan.html"> C-SCAN</a>
            <a href="../Webpages/look.html"> LOOK</a>
            <a href="../Webpages/c-look.html"> C-LOOK</a>
        </div>
    </div>

    <div class="about">
        <a href="../Webpages/about.html"><button class="about-btn"> About Us </button></a>
    </nav>

    <div id="graph-container">
        <canvas id="graphStatic"></canvas>
        <canvas id="graphCanvas"></canvas>
    </div>

    <script src="../Webpages/graph.js"></script>
    <script>
        function sstfAlgorithm(requests, head) {
            let seq = [head];
            // Work on a copy and ignore requests equal to head
            let rem = [...(requests || []).filter(x => x !== head)];
            let cur = head;
            while (rem.length > 0) {
                let min = Infinity, idx = 0;
                for (let i = 0; i < rem.length; i++) {
                    if (Math.abs(rem[i] - cur) < min) {
                        min = Math.abs(rem[i] - cur);
                        idx = i;
                    }
                }
                cur = rem[idx];
                seq.push(cur);
                rem.splice(idx, 1);
            }
            return seq;
        }

        document.querySelector('.run').addEventListener('click', async function() {
            let req = document.querySelectorAll('input')[0].value.split(',').map(x => parseInt(x.trim())).filter(x => !isNaN(x));
            let head = parseInt(document.querySelectorAll('input')[1].value);
            
            // Validate head range
            if (isNaN(head) || head < 0 || head > 199) {
                alert('Error: Initial head position cannot exceed 199');
                return;
            }
            
            // Validate that all requests are in range [0,199]
            if (req.some(x => x > 199 || x < 0)) {
                alert('Error: Request sequence values must be between 0 and 199');
                return;
            }
            
            if (!isNaN(head) && req.length > 0) {
                let seq = sstfAlgorithm(req, head);
                let seek = 0;
                for (let i = 1; i < seq.length; i++) seek += Math.abs(seq[i] - seq[i-1]);

                // Display computation results immediately
                let out = document.querySelectorAll('.expected-output p');
                out[0].textContent = 'Total seek time is: ' + seek;
                out[1].textContent = 'Sequence of execution: ' + seq.join(' â†’ ');
                out[2].textContent = 'Average seek time: ' + (seek / (seq.length - 1)).toFixed(2);

                // Then animate the sequence
                if (window.graph) await window.graph.animate(seq);
            }
        });
    </script>
</body>
</html>